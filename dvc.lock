schema: '2.0'
stages:
  download_and_extract_osm:
    cmd: wget -c --limit-rate=10M -P data/
      "https://download.geofabrik.de/russia/northwestern-fed-district-latest.osm.pbf"
      && osmium extract --bbox "30.21137,59.93016,30.33497,59.98456"
      data/northwestern-fed-district-latest.osm.pbf --output data/map.osm.pbf
    params:
      params.yaml:
        prepare_satellite_data.map_box:
        - 30.21137
        - 59.93016
        - 30.33497
        - 59.98456
        prepare_satellite_data.osm: data/map.osm.pbf
    outs:
    - path: data/map.osm.pbf
      hash: md5
      md5: 269c4596424839c3fad08f3950bdc6d6
      size: 5172215
    - path: data/northwestern-fed-district-latest.osm.pbf
      hash: md5
      md5: 733f1de0c259c02eb666efb46db50f50
      size: 631217034
  prepare_satellite_data:
    cmd: python scripts/prepare_satellite_data.py
    params:
      params.yaml:
        prepare_satellite_data:
          classes:
          - - road
            - 255
          - - building
            - 255
          - - parking
            - 255
          - - water
            - 255
          - - field
            - 255
          data_dir: data/satellite
          max_workers: 5
          zoom: 17
          num_tiles: 10
          tile_size: 256
          map_box:
          - 30.21137
          - 59.93016
          - 30.33497
          - 59.98456
          osm: data/map.osm.pbf
          sources:
            google: http://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}
            bing: http://a0.ortho.tiles.virtualearth.net/tiles/a{}.jpeg?g=2
            arcgis:
              https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}
            yandex: https://sat04.maps.yandex.net/tiles?l=sat&x={x}&y={y}&z={z}
    outs:
    - path: data/satellite
      hash: md5
      md5: c0ac4bafbe13515be2e9901904042146.dir
      size: 1272171678
      nfiles: 153
