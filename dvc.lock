schema: '2.0'
stages:
  download_and_extract_osm:
    cmd: wget -c --limit-rate=10M -P data/
      "https://download.geofabrik.de/russia/northwestern-fed-district-latest.osm.pbf"
      && osmium extract --bbox "30.21137,59.93016,30.33497,59.98456"
      data/northwestern-fed-district-latest.osm.pbf --output data/map.osm.pbf
    params:
      params.yaml:
        prepare_satellite_data.map_box:
        - 30.21137
        - 59.93016
        - 30.33497
        - 59.98456
        prepare_satellite_data.osm: data/map.osm.pbf
    outs:
    - path: data/map.osm.pbf
      hash: md5
      md5: 00352bc23f907dbdc84bca4bdfd6dab3
      size: 5172225
    - path: data/northwestern-fed-district-latest.osm.pbf
      hash: md5
      md5: 9f9bc1e4754daa1ee1c453f9491308d5
      size: 631026716
  prepare_satellite_data:
    cmd: python scripts/prepare_satellite_data.py
    params:
      params.yaml:
        prepare_satellite_data:
          classes:
          - - road
            - 255
          - - building
            - 255
          - - parking
            - 255
          - - water
            - 255
          - - field
            - 255
          data_dir: data/satellite
          max_workers: 5
          zoom: 17
          num_tiles: 10
          tile_size: 256
          map_box:
          - 30.21137
          - 59.93016
          - 30.33497
          - 59.98456
          osm: data/map.osm.pbf
          sources:
            yandex: https://sat04.maps.yandex.net/tiles?l=sat&x={x}&y={y}&z={z}
    outs:
    - path: data/satellite
      hash: md5
      md5: e215c60fe211d4df965feb52c49686e9.dir
      size: 28295177
      nfiles: 96
