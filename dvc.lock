schema: '2.0'
stages:
  download_and_extract_osm:
    cmd: wget -c --limit-rate=10M -P data/
      "https://download.geofabrik.de/russia/northwestern-fed-district-latest.osm.pbf"
      && osmium extract --bbox "30.21137,59.93016,30.33497,59.98456"
      data/northwestern-fed-district-latest.osm.pbf --output data/map.osm.pbf
    params:
      params.yaml:
        prepare_satellite_data.map_box:
        - 30.21137
        - 59.93016
        - 30.33497
        - 59.98456
        prepare_satellite_data.osm: data/map.osm.pbf
    outs:
    - path: data/map.osm.pbf
      hash: md5
      md5: 00352bc23f907dbdc84bca4bdfd6dab3
      size: 5172225
    - path: data/northwestern-fed-district-latest.osm.pbf
      hash: md5
      md5: 9f9bc1e4754daa1ee1c453f9491308d5
      size: 631026716
  prepare_satellite_data:
    cmd: python scripts/prepare_satellite_data.py
    params:
      params.yaml:
        prepare_satellite_data:
          classes:
          - - road
            - 255
          data_dir: data/satellite
          max_workers: 5
          zoom: 17
          num_tiles: 10
          tile_size: 256
          map_box:
          - 30.21137
          - 59.93016
          - 30.33497
          - 59.98456
          osm: data/map.osm.pbf
          sources:
            google: http://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}
            bing: http://a0.ortho.tiles.virtualearth.net/tiles/a{}.jpeg?g=2
            arcgis:
              https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}
    outs:
    - path: data/satellite
      hash: md5
      md5: 8c901a0044b76b97a8a9d2c37f9aca28.dir
      size: 66414209
      nfiles: 64
